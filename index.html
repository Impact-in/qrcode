<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --primary-500: #3b82f6;
            --primary-600: #2563eb;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.5;
            padding: 1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .app-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .app-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--gray-900);
        }

        .app-subtitle {
            color: var(--gray-500);
            font-size: 0.875rem;
        }

        .app-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .app-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .container { padding: 1rem; }
        }

        .form-card, .preview-card {
            background-color: white;
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1.5rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--gray-900);
            border-left: 3px solid var(--primary-500);
            padding-left: 0.75rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.375rem;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.375rem;
            transition: all 0.15s ease;
        }

        input[type="color"] {
            -webkit-appearance: none;
            appearance: none;
            width: 2.5rem;
            height: 2.5rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.375rem;
            cursor: pointer;
        }

        input[type="file"] {
            width: 100%;
            padding: 0.5rem 0;
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .color-picker-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .color-picker-group input[type="text"] {
            flex: 1;
        }

        button {
            background-color: var(--primary-500);
            color: white;
            border: none;
            border-radius: 0.375rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            width: 100%;
        }

        button:hover {
            background-color: var(--primary-600);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
        }

        button:active {
            transform: translateY(0);
        }

        #generate {
            margin-top: 0.75rem;
        }

        .preview-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        #qrcode-container {
            display: none !important;
        }

        #qrcode-image {
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: var(--gray-200);
            border-radius: 2px;
            margin: 0.5rem 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary-500);
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--primary-500);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-header">
            <h1 class="app-title">QR Code Generator</h1>
            <p class="app-subtitle">Create customized QR codes with logo and styling options</p>
        </div>
        
        <div class="app-layout">
            <div class="form-card">
                <h2 class="card-title">Customize Your QR Code</h2>
                
                <div class="form-group">
                    <label for="url">URL or Text to encode</label>
                    <input type="text" id="url" placeholder="https://example.com" value="https://example.com">
                </div>
                
                <div class="form-group">
                    <label for="text">Text label (shown below QR code)</label>
                    <input type="text" id="text" placeholder="REPORT" value="REPORT">
                </div>
                
                <div class="form-group">
                    <label for="logo">Logo image (Empty For AJCE logo)</label>
                    <input type="file" id="logo" accept="image/*">
                </div>
                
                <div class="form-group">
                    <label for="logo-color">Logo Border Color</label>
                    <div class="color-picker-group">
                        <input type="color" id="logo-color" value="#0094ff">
                        <input type="text" id="logo-color-text" value="#0094ff" placeholder="#0094ff">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="size">QR Code Size (pixels)</label>
                    <input type="range" id="size" min="100" max="1000" value="300">
                    <input type="number" id="size-value" min="100" max="1000" value="300">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="border-width">Black Border Width (px)</label>
                        <input type="range" id="border-width" min="5" max="50" value="10">
                        <input type="number" id="border-width-value" min="5" max="50" value="10">
                    </div>
                    
                    <div class="form-group">
                        <label for="white-padding">White Padding (px)</label>
                        <input type="range" id="white-padding" min="5" max="50" value="20">
                        <input type="number" id="white-padding-value" min="5" max="50" value="20">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="border-radius">Border Radius (px)</label>
                        <input type="range" id="border-radius" min="0" max="50" value="20">
                        <input type="number" id="border-radius-value" min="0" max="50" value="20">
                    </div>
                    
                    <div class="form-group">
                        <label for="bottom-height">Bottom Text Height (px)</label>
                        <input type="range" id="bottom-height" min="20" max="100" value="60">
                        <input type="number" id="bottom-height-value" min="20" max="100" value="60">
                    </div>
                </div>
                
                <button id="generate">Generate QR Code</button>
            </div>
            
            <div class="preview-card">
                <h2 class="card-title">Preview</h2>
                <div class="preview-content">
                    <div id="qrcode-container">
                        <div class="qr-wrapper">
                            <div class="qr-inner-wrapper">
                                <div id="qrcode"></div>
                            </div>
                            <div id="qr-text">REPORT</div>
                        </div>
                    </div>
                    <img id="qrcode-image" alt="QR Preview" style="display:block; max-width:100%; width:300px; border-radius:10px; margin-top:12px;" />
                    <button id="download">Download QR Code</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const generateBtn = document.getElementById('generate');
            const downloadBtn = document.getElementById('download');
            const qrcodeContainer = document.getElementById('qrcode');
            const qrTextElement = document.getElementById('qr-text');
            const qrWrapper = document.querySelector('.qr-wrapper');
            const qrInnerWrapper = document.querySelector('.qr-inner-wrapper');
            
            // Connect range inputs with number inputs
            connectRangeAndNumber('size', 'size-value');
            connectRangeAndNumber('border-width', 'border-width-value');
            connectRangeAndNumber('white-padding', 'white-padding-value');
            connectRangeAndNumber('border-radius', 'border-radius-value');
            connectRangeAndNumber('bottom-height', 'bottom-height-value');
            
            // Connect color picker with text input
            const logoColorPicker = document.getElementById('logo-color');
            const logoColorText = document.getElementById('logo-color-text');
            
            logoColorPicker.addEventListener('input', function() {
                logoColorText.value = this.value;
            });
            
            logoColorText.addEventListener('input', function() {
                if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                    logoColorPicker.value = this.value;
                }
            });
            
            function connectRangeAndNumber(rangeId, numberId) {
                const rangeInput = document.getElementById(rangeId);
                const numberInput = document.getElementById(numberId);
                
                rangeInput.addEventListener('input', function() {
                    numberInput.value = this.value;
                });
                
                numberInput.addEventListener('input', function() {
                    rangeInput.value = this.value;
                });
            }
            
            let qrInstance = null;
            
            generateBtn.addEventListener('click', generateQRCode);
            downloadBtn.addEventListener('click', downloadQRCode);
            
            // Generate default QR code on page load
            generateQRCode();
            
            function generateQRCode() {
                const url = document.getElementById('url').value || 'https://example.com';
                const text = document.getElementById('text').value || 'REPORT';
                const logoInput = document.getElementById('logo');
                const logoColor = document.getElementById('logo-color').value || '#0094ff';
                const size = parseInt(document.getElementById('size-value').value) || 300;
                const borderWidth = parseInt(document.getElementById('border-width-value').value) || 10;
                const whitePadding = parseInt(document.getElementById('white-padding-value').value) || 20;
                const borderRadius = parseInt(document.getElementById('border-radius-value').value) || 10;
                const bottomHeight = parseInt(document.getElementById('bottom-height-value').value) || 30;
                
                // Update border width and radius
                qrWrapper.style.padding = borderWidth + 'px';
                qrWrapper.style.borderRadius = borderRadius + 'px';
                
                // Update white padding
                qrInnerWrapper.style.padding = whitePadding + 'px';
                qrInnerWrapper.style.borderRadius = (borderRadius - 2) + 'px';
                
                // Update text area height
                qrTextElement.style.height = bottomHeight + 'px';
                qrTextElement.style.lineHeight = bottomHeight + 'px';
                
                // Update text
                qrTextElement.textContent = text;
                
                // Clear previous QR code
                qrcodeContainer.innerHTML = '';
                
                // Create new QR code with higher quality settings
                qrInstance = new QRCode(qrcodeContainer, {
                    text: url,
                    width: size * 2, // Double resolution for better quality
                    height: size * 2,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H // High error correction to allow for logo
                });

                // Scale down the canvas for display but keep high resolution for rendering
                setTimeout(() => {
                    const canvas = qrcodeContainer.querySelector('canvas');
                    if (canvas) {
                        canvas.style.width = size + 'px';
                        canvas.style.height = size + 'px';
                        // Ensure high-DPI rendering
                        const ctx = canvas.getContext('2d');
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                    }
                }, 10);

                // Update preview immediately (if there is no logo or while logo loads)
                updatePreview();
                
                // Add logo: use selected file if provided; otherwise try default 'amaljyothi.pn'/'amaljyothi.png'
                (function handleLogo() {
                    if (logoInput.files && logoInput.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const logo = new Image();
                            logo.src = e.target.result;
                            logo.onload = function() {
                                // Need to wait a bit for QR code to render before adding logo
                                setTimeout(() => addLogoToQRCode(logo, size, logoColor), 50);
                            };
                        };
                        reader.readAsDataURL(logoInput.files[0]);
                        return;
                    }

                    // No file selected: attempt to load default logo files in order
                    const candidates = ['amaljyothi.pn', 'amaljyothi.png'];
                    let idx = 0;
                    function tryLoadDefault() {
                        if (idx >= candidates.length) return; // nothing found
                        const logo = new Image();
                        // Allow cross-origin loading if file is served from another origin
                        logo.crossOrigin = 'anonymous';
                        logo.src = candidates[idx];
                        logo.onload = function() {
                            // Wait a bit for QR code to render before adding logo
                            setTimeout(() => addLogoToQRCode(logo, size, logoColor), 50);
                        };
                        logo.onerror = function() {
                            idx++;
                            tryLoadDefault();
                        };
                    }
                    tryLoadDefault();
                })();
            }
            
            function addLogoToQRCode(logoImg, size, logoColor) {
                // Get the QR code canvas
                const canvas = qrcodeContainer.querySelector('canvas');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');

                // Enable high-quality rendering
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';

                // Get actual canvas dimensions (which are 2x the display size)
                const actualSize = canvas.width; // This should be size * 2
                const scale = actualSize / size; // Should be 2

                // Calculate logo size (about 20% of QR code) scaled to actual canvas size
                const logoSize = actualSize * 0.2;
                const logoX = (actualSize - logoSize) / 2;
                const logoY = (actualSize - logoSize) / 2;

                // Create circular white background (slightly larger than logo)
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                ctx.arc(actualSize / 2, actualSize / 2, logoSize / 1.8, 0, Math.PI * 2);
                ctx.fill();

                // Removed colored border: do not draw a stroked circle around the logo.
                // Keep a circular clipping path and draw the logo inside it.
                ctx.save();
                ctx.beginPath();
                ctx.arc(actualSize / 2, actualSize / 2, logoSize / 2 - 1, 0, Math.PI * 2);
                ctx.clip();

                // Draw logo with high quality
                ctx.drawImage(logoImg, logoX, logoY, logoSize, logoSize);
                ctx.restore();

                // After adding the logo, update the image preview to reflect the final composition
                updatePreview();
            }

            // Build the full composed canvas (black border, white inner, QR canvas, and bottom text)
            function createFullCanvasFromCanvas(qrCanvas, text, size, borderWidth, whitePadding, borderRadius, bottomHeight) {
                // Use high resolution for better quality (2x)
                const scale = 2;
                const actualQRSize = qrCanvas.width; // This is already 2x the display size
                const displaySize = size;
                
                // Calculate total dimensions at high resolution
                const totalWidth = (displaySize + (whitePadding * 2) + (borderWidth * 2)) * scale;
                const totalHeight = (displaySize + (whitePadding * 2) + (borderWidth * 2) + bottomHeight) * scale;

                const fullCanvas = document.createElement('canvas');
                fullCanvas.width = totalWidth;
                fullCanvas.height = totalHeight;
                const ctx = fullCanvas.getContext('2d');

                // Enable high-quality rendering
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';

                // Function to draw a rounded rectangle
                function roundRect(ctx, x, y, width, height, radius) {
                    ctx.beginPath();
                    ctx.moveTo(x + radius, y);
                    ctx.lineTo(x + width - radius, y);
                    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
                    ctx.lineTo(x + width, y + height - radius);
                    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
                    ctx.lineTo(x + radius, y + height);
                    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
                    ctx.lineTo(x, y + radius);
                    ctx.quadraticCurveTo(x, y, x + radius, y);
                    ctx.closePath();
                }

                // Scale all measurements for high resolution
                const scaledBorderWidth = borderWidth * scale;
                const scaledWhitePadding = whitePadding * scale;
                const scaledBorderRadius = (borderRadius || 0) * scale;
                const scaledBottomHeight = bottomHeight * scale;

                // Draw black background with rounded corners
                ctx.fillStyle = '#000000';
                roundRect(ctx, 0, 0, totalWidth, totalHeight, scaledBorderRadius);
                ctx.fill();

                // Draw white background with rounded corners
                ctx.fillStyle = '#FFFFFF';
                roundRect(ctx, scaledBorderWidth, scaledBorderWidth, 
                         totalWidth - (scaledBorderWidth * 2), 
                         totalHeight - scaledBorderWidth * 2 - scaledBottomHeight, 
                         Math.max(scaledBorderRadius - 2 * scale, 0));
                ctx.fill();

                // Draw the QR code onto the main canvas (already at correct resolution)
                ctx.drawImage(qrCanvas, scaledBorderWidth + scaledWhitePadding, scaledBorderWidth + scaledWhitePadding);

                // Draw text with scaled font size
                ctx.fillStyle = '#FFFFFF';
                ctx.font = `bold ${20 * scale}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText(text, totalWidth / 2, totalHeight - (scaledBottomHeight / 2) + 5 * scale);

                return fullCanvas;
            }

            // Update the <img> preview with the composed image if QR canvas exists
            function updatePreview() {
                const canvas = qrcodeContainer.querySelector('canvas');
                const previewImg = document.getElementById('qrcode-image');
                if (!canvas || !previewImg) return;

                const text = document.getElementById('text').value || 'REPORT';
                const size = parseInt(document.getElementById('size-value').value) || 300;
                const borderWidth = parseInt(document.getElementById('border-width-value').value) || 10;
                const whitePadding = parseInt(document.getElementById('white-padding-value').value) || 20;
                const borderRadius = parseInt(document.getElementById('border-radius-value').value) || 10;
                const bottomHeight = parseInt(document.getElementById('bottom-height-value').value) || 30;

                const fullCanvas = createFullCanvasFromCanvas(canvas, text, size, borderWidth, whitePadding, borderRadius, bottomHeight);
                previewImg.src = fullCanvas.toDataURL('image/png');
                // Make sure the preview image size matches requested size visually
                previewImg.style.width = Math.min(size + (whitePadding * 2) + (borderWidth * 2), 400) + 'px';
                previewImg.style.display = 'block';
            }
            
            function downloadQRCode() {
                const canvas = qrcodeContainer.querySelector('canvas');
                if (!canvas) return;
                const text = document.getElementById('text').value || 'REPORT';
                const size = parseInt(document.getElementById('size-value').value) || 300;
                const borderWidth = parseInt(document.getElementById('border-width-value').value) || 10;
                const whitePadding = parseInt(document.getElementById('white-padding-value').value) || 20;
                const borderRadius = parseInt(document.getElementById('border-radius-value').value) || 10;
                const bottomHeight = parseInt(document.getElementById('bottom-height-value').value) || 30;

                const fullCanvas = createFullCanvasFromCanvas(canvas, text, size, borderWidth, whitePadding, borderRadius, bottomHeight);

                // Create download link
                const link = document.createElement('a');
                link.download = 'qrcode.png';
                link.href = fullCanvas.toDataURL('image/png');
                link.click();
            }
        });
    </script>
</body>
</html>
